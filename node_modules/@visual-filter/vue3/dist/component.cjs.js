"use strict";var e=require("vue"),t=require("@visual-filter/common");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=n(require("@visual-filter/applyer"));function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,i=[],l=!0,a=!1;try{for(n=n.call(e);!(l=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);l=!0);}catch(e){a=!0,o=e}finally{try{l||null==n.return||n.return()}finally{if(a)throw o}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var l={name:"FilterGroup",emits:["addFilter","deleteGroup"],props:{group:{type:Object,required:!0,validator:function(e){return e.constructor===Object}},filterTypes:{type:Array,required:!0},groupTypes:{type:Array,required:!0},removable:{type:Boolean,required:!0}},methods:{addFilter:function(e){this.filterTypes.includes(e)&&this.$emit("addFilter",this.group.filters,e)}}},a={class:"space-y-4"},u={class:"space-x-2"},d=["value"],s=["value"],c={key:0,class:"ml-10 space-y-1"};l.render=function(t,n,r,o,i,l){return e.openBlock(),e.createElementBlock("div",a,[e.createElementVNode("div",u,[e.renderSlot(t.$slots,"groupTypes",e.normalizeProps(e.guardReactiveProps({groupTypes:r.groupTypes,group:r.group})),(function(){return[e.withDirectives(e.createElementVNode("select",{"onUpdate:modelValue":n[0]||(n[0]=function(e){return r.group.groupType=e})},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.groupTypes,(function(t){return e.openBlock(),e.createElementBlock("option",{key:t,value:t},e.toDisplayString(t),9,d)})),128))],512),[[e.vModelSelect,r.group.groupType]])]})),e.renderSlot(t.$slots,"filterAddition",e.normalizeProps(e.guardReactiveProps({filterTypes:r.filterTypes,addFilter:l.addFilter})),(function(){return[e.createElementVNode("select",{onChange:n[1]||(n[1]=function(e){return l.addFilter(e.target.value)})},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.filterTypes,(function(t){return e.openBlock(),e.createElementBlock("option",{key:t,value:t},e.toDisplayString(t),9,s)})),128))],32)]})),r.removable?e.renderSlot(t.$slots,"groupDeletion",{key:0,deleteGroup:function(){return t.$emit("deleteGroup",r.group)}},(function(){return[e.createElementVNode("button",{onClick:n[2]||(n[2]=function(e){return t.$emit("deleteGroup",r.group)})},"x")]})):e.createCommentVNode("",!0)]),r.group.filters.length?(e.openBlock(),e.createElementBlock("div",c,[e.renderSlot(t.$slots,"groupChildren")])):e.createCommentVNode("",!0)])};var p={name:"FilterCondition",emits:["updateField","deleteCondition"],props:{condition:{type:Object,required:!0,validator:function(e){return e.constructor===Object}},fieldNames:{type:Array,required:!0},numericMethodNames:{type:Array,required:!0},nominalMethodNames:{type:Array,required:!0}},computed:{isNumeric:function(){return this.condition.dataType===t.DataType.NUMERIC}},methods:{updateField:function(e){this.fieldNames.includes(e)&&this.$emit("updateField",this.condition,e)}}},m={class:"space-x-2"},f=["value"],y=["value"];p.render=function(t,n,r,o,i,l){return e.openBlock(),e.createElementBlock("div",m,[e.renderSlot(t.$slots,"fieldUpdation",e.normalizeProps(e.guardReactiveProps({fieldNames:r.fieldNames,condition:r.condition,updateField:l.updateField})),(function(){return[e.withDirectives(e.createElementVNode("select",{"onUpdate:modelValue":n[0]||(n[0]=function(e){return r.condition.fieldName=e}),onChange:n[1]||(n[1]=function(e){return l.updateField(e.target.value)})},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.fieldNames,(function(t){return e.openBlock(),e.createElementBlock("option",{key:t,value:t},e.toDisplayString(t),9,f)})),128))],544),[[e.vModelSelect,r.condition.fieldName]])]})),e.renderSlot(t.$slots,"methodUpdation",e.normalizeProps(e.guardReactiveProps({numericMethodNames:l.isNumeric&&r.numericMethodNames,nominalMethodNames:l.isNumeric||r.nominalMethodNames,condition:r.condition})),(function(){return[e.withDirectives(e.createElementVNode("select",{"onUpdate:modelValue":n[2]||(n[2]=function(e){return r.condition.method=e})},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.isNumeric?r.numericMethodNames:r.nominalMethodNames,(function(t){return e.openBlock(),e.createElementBlock("option",{key:t,value:t},e.toDisplayString(t),9,y)})),128))],512),[[e.vModelSelect,r.condition.method]])]})),e.renderSlot(t.$slots,"argumentUpdation",{condition:r.condition},(function(){return[e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":n[3]||(n[3]=function(e){return r.condition.argument=e})},null,512),[[e.vModelText,r.condition.argument]])]})),e.renderSlot(t.$slots,"conditionDeletion",{deleteCondition:function(){return t.$emit("deleteCondition",r.condition)}},(function(){return[e.createElementVNode("button",{onClick:n[4]||(n[4]=function(e){return t.$emit("deleteCondition",r.condition)})},"x")]}))])};var h={name:"VueVisualFilter",emits:["filterUpdate"],props:{filteringOptions:{type:Object,required:!0,validator:function(e){try{return e.data.length&&e.data.every((function(e,t,n){return!("string"!=typeof e.name||"string"!=typeof e.type||e.values.constructor!==Array||t>0&&e.values.length!==n[t-1].values.length)}))&&Object.values(e.methods.numeric).every((function(e){return"function"==typeof e}))&&Object.values(e.methods.nominal).every((function(e){return"function"==typeof e}))}catch(e){return!1}}}},data:function(){return{filter:{type:t.FilterType.GROUP,groupType:t.GroupType.AND,filters:[]}}},computed:{fieldNames:function(){return this.filteringOptions.data.map((function(e){return e.name}))},numericMethodNames:function(){return Object.keys(this.filteringOptions.methods.numeric)},nominalMethodNames:function(){return Object.keys(this.filteringOptions.methods.nominal)}},watch:{filter:{deep:!0,handler:function(){this.$emit("filterUpdate",{filter:t.deepCopy(this.filter),data:r.default(this.filter,this.filteringOptions.methods,t.deepCopy(this.filteringOptions.data))})}}},methods:{updateConditionField:function(e,n){var r=this.filteringOptions.data.find((function(e){return e.name===n})),i=r.type,l=o(r.values,1)[0],a=void 0===l?"":l;e.dataType!==i&&(e.method=(i===t.DataType.NUMERIC?this.numericMethodNames[0]:this.nominalMethodNames[0])||"",e.argument=a,e.dataType=i)},addFilter:function(e,n){if(n===t.FilterType.GROUP)e.push({type:t.FilterType.GROUP,groupType:t.GroupType.AND,filters:[]});else{var r=this.filteringOptions.data[0],i=r.name,l=r.type,a=o(r.values,1)[0],u=void 0===a?"":a;e.push({type:t.FilterType.CONDITION,fieldName:i,dataType:l,method:(l===t.DataType.NUMERIC?this.numericMethodNames[0]:this.nominalMethodNames[0])||"",argument:u})}},deleteFilter:function(e){e!==this.filter&&function n(r,o,i){r===e?i.splice(o,1):r.type===t.FilterType.GROUP&&r.filters.map(n)}(this.filter)}},render:function(){var n=this;return function r(o){return o.type===t.FilterType.GROUP?e.h(l,{group:o,filterTypes:Object.values(t.FilterType),groupTypes:Object.values(t.GroupType),removable:o!==n.filter,onAddFilter:n.addFilter,onDeleteGroup:n.deleteFilter},{groupTypes:n.$slots.groupTypes,filterAddition:n.$slots.filterAddition,groupDeletion:n.$slots.groupDeletion,groupChildren:function(){return o.filters.map(r)}}):e.h(p,{condition:o,fieldNames:n.fieldNames,numericMethodNames:n.numericMethodNames,nominalMethodNames:n.nominalMethodNames,onUpdateField:n.updateConditionField,onDeleteCondition:n.deleteFilter},{fieldUpdation:n.$slots.fieldUpdation,methodUpdation:n.$slots.methodUpdation,argumentUpdation:n.$slots.argumentUpdation,conditionDeletion:n.$slots.conditionDeletion})}(this.filter)},install:function(e){e.component(h.name,h)}};module.exports=h;
