import{openBlock as e,createElementBlock as t,createElementVNode as n,renderSlot as i,normalizeProps as r,guardReactiveProps as o,withDirectives as u,Fragment as l,renderList as a,toDisplayString as d,vModelSelect as s,createCommentVNode as p,vModelText as c,h as f}from"vue";import{DataType as m,FilterType as y,GroupType as h,deepCopy as g}from"@visual-filter/common";import v from"@visual-filter/applyer";function N(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var i,r,o=[],u=!0,l=!1;try{for(n=n.call(e);!(u=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);u=!0);}catch(e){l=!0,r=e}finally{try{u||null==n.return||n.return()}finally{if(l)throw r}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var b={name:"FilterGroup",emits:["addFilter","deleteGroup"],props:{group:{type:Object,required:!0,validator:function(e){return e.constructor===Object}},filterTypes:{type:Array,required:!0},groupTypes:{type:Array,required:!0},removable:{type:Boolean,required:!0}},methods:{addFilter:function(e){this.filterTypes.includes(e)&&this.$emit("addFilter",this.group.filters,e)}}},U={class:"space-y-4"},F={class:"space-x-2"},T=["value"],$=["value"],M={key:0,class:"ml-10 space-y-1"};b.render=function(c,f,m,y,h,g){return e(),t("div",U,[n("div",F,[i(c.$slots,"groupTypes",r(o({groupTypes:m.groupTypes,group:m.group})),(function(){return[u(n("select",{"onUpdate:modelValue":f[0]||(f[0]=function(e){return m.group.groupType=e})},[(e(!0),t(l,null,a(m.groupTypes,(function(n){return e(),t("option",{key:n,value:n},d(n),9,T)})),128))],512),[[s,m.group.groupType]])]})),i(c.$slots,"filterAddition",r(o({filterTypes:m.filterTypes,addFilter:g.addFilter})),(function(){return[n("select",{onChange:f[1]||(f[1]=function(e){return g.addFilter(e.target.value)})},[(e(!0),t(l,null,a(m.filterTypes,(function(n){return e(),t("option",{key:n,value:n},d(n),9,$)})),128))],32)]})),m.removable?i(c.$slots,"groupDeletion",{key:0,deleteGroup:function(){return c.$emit("deleteGroup",m.group)}},(function(){return[n("button",{onClick:f[2]||(f[2]=function(e){return c.$emit("deleteGroup",m.group)})},"x")]})):p("",!0)]),m.group.filters.length?(e(),t("div",M,[i(c.$slots,"groupChildren")])):p("",!0)])};var C={name:"FilterCondition",emits:["updateField","deleteCondition"],props:{condition:{type:Object,required:!0,validator:function(e){return e.constructor===Object}},fieldNames:{type:Array,required:!0},numericMethodNames:{type:Array,required:!0},nominalMethodNames:{type:Array,required:!0}},computed:{isNumeric:function(){return this.condition.dataType===m.NUMERIC}},methods:{updateField:function(e){this.fieldNames.includes(e)&&this.$emit("updateField",this.condition,e)}}},A={class:"space-x-2"},j=["value"],D=["value"];C.render=function(p,f,m,y,h,g){return e(),t("div",A,[i(p.$slots,"fieldUpdation",r(o({fieldNames:m.fieldNames,condition:m.condition,updateField:g.updateField})),(function(){return[u(n("select",{"onUpdate:modelValue":f[0]||(f[0]=function(e){return m.condition.fieldName=e}),onChange:f[1]||(f[1]=function(e){return g.updateField(e.target.value)})},[(e(!0),t(l,null,a(m.fieldNames,(function(n){return e(),t("option",{key:n,value:n},d(n),9,j)})),128))],544),[[s,m.condition.fieldName]])]})),i(p.$slots,"methodUpdation",r(o({numericMethodNames:g.isNumeric&&m.numericMethodNames,nominalMethodNames:g.isNumeric||m.nominalMethodNames,condition:m.condition})),(function(){return[u(n("select",{"onUpdate:modelValue":f[2]||(f[2]=function(e){return m.condition.method=e})},[(e(!0),t(l,null,a(g.isNumeric?m.numericMethodNames:m.nominalMethodNames,(function(n){return e(),t("option",{key:n,value:n},d(n),9,D)})),128))],512),[[s,m.condition.method]])]})),i(p.$slots,"argumentUpdation",{condition:m.condition},(function(){return[u(n("input",{type:"text","onUpdate:modelValue":f[3]||(f[3]=function(e){return m.condition.argument=e})},null,512),[[c,m.condition.argument]])]})),i(p.$slots,"conditionDeletion",{deleteCondition:function(){return p.$emit("deleteCondition",m.condition)}},(function(){return[n("button",{onClick:f[4]||(f[4]=function(e){return p.$emit("deleteCondition",m.condition)})},"x")]}))])};var G={name:"VueVisualFilter",emits:["filterUpdate"],props:{filteringOptions:{type:Object,required:!0,validator:function(e){try{return e.data.length&&e.data.every((function(e,t,n){return!("string"!=typeof e.name||"string"!=typeof e.type||e.values.constructor!==Array||t>0&&e.values.length!==n[t-1].values.length)}))&&Object.values(e.methods.numeric).every((function(e){return"function"==typeof e}))&&Object.values(e.methods.nominal).every((function(e){return"function"==typeof e}))}catch(e){return!1}}}},data:function(){return{filter:{type:y.GROUP,groupType:h.AND,filters:[]}}},computed:{fieldNames:function(){return this.filteringOptions.data.map((function(e){return e.name}))},numericMethodNames:function(){return Object.keys(this.filteringOptions.methods.numeric)},nominalMethodNames:function(){return Object.keys(this.filteringOptions.methods.nominal)}},watch:{filter:{deep:!0,handler:function(){this.$emit("filterUpdate",{filter:g(this.filter),data:v(this.filter,this.filteringOptions.methods,g(this.filteringOptions.data))})}}},methods:{updateConditionField:function(e,t){var n=this.filteringOptions.data.find((function(e){return e.name===t})),i=n.type,r=N(n.values,1)[0],o=void 0===r?"":r;e.dataType!==i&&(e.method=(i===m.NUMERIC?this.numericMethodNames[0]:this.nominalMethodNames[0])||"",e.argument=o,e.dataType=i)},addFilter:function(e,t){if(t===y.GROUP)e.push({type:y.GROUP,groupType:h.AND,filters:[]});else{var n=this.filteringOptions.data[0],i=n.name,r=n.type,o=N(n.values,1)[0],u=void 0===o?"":o;e.push({type:y.CONDITION,fieldName:i,dataType:r,method:(r===m.NUMERIC?this.numericMethodNames[0]:this.nominalMethodNames[0])||"",argument:u})}},deleteFilter:function(e){e!==this.filter&&function t(n,i,r){n===e?r.splice(i,1):n.type===y.GROUP&&n.filters.map(t)}(this.filter)}},render:function(){var e=this;return function t(n){return n.type===y.GROUP?f(b,{group:n,filterTypes:Object.values(y),groupTypes:Object.values(h),removable:n!==e.filter,onAddFilter:e.addFilter,onDeleteGroup:e.deleteFilter},{groupTypes:e.$slots.groupTypes,filterAddition:e.$slots.filterAddition,groupDeletion:e.$slots.groupDeletion,groupChildren:function(){return n.filters.map(t)}}):f(C,{condition:n,fieldNames:e.fieldNames,numericMethodNames:e.numericMethodNames,nominalMethodNames:e.nominalMethodNames,onUpdateField:e.updateConditionField,onDeleteCondition:e.deleteFilter},{fieldUpdation:e.$slots.fieldUpdation,methodUpdation:e.$slots.methodUpdation,argumentUpdation:e.$slots.argumentUpdation,conditionDeletion:e.$slots.conditionDeletion})}(this.filter)},install:function(e){e.component(G.name,G)}};export{G as default};
