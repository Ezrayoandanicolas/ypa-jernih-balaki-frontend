var VueVisualFilter=function(e){"use strict";function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,i=[],l=!0,u=!1;try{for(n=n.call(e);!(l=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);l=!0);}catch(e){u=!0,o=e}finally{try{l||null==n.return||n.return()}finally{if(u)throw o}}return i}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var r,o,i,l,u,a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},d={};r=d,u=a&&a.__assign||function(){return(u=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Object.defineProperty(r,"__esModule",{value:!0}),r.deepCopy=r.DataType=r.GroupType=r.FilterType=void 0,(o=r.FilterType||(r.FilterType={})).GROUP="group",o.CONDITION="condition",(i=r.GroupType||(r.GroupType={})).AND="and",i.NOT_AND="not and",i.OR="or",i.NOT_OR="not or",(l=r.DataType||(r.DataType={})).NUMERIC="numeric",l.NOMINAL="nominal",r.deepCopy=function e(t){return t.constructor===Object?Object.entries(t).reduce((function(t,n){var r,o=n[0],i=n[1];return u(u({},t),((r={})[o]=e(i),r))}),{}):t.constructor===Array?t.map(e):t.valueOf()};var p=d,c=function(e,t,n){function r(e,t,n){for(var o,i=0;i<t.length;++i){if(!0===((null===(o=t[i][0])||void 0===o?void 0:o.constructor)===Array?r(e,t[i],n.filters[i]):t[i][e]))switch(n.groupType){case p.GroupType.AND:continue;case p.GroupType.NOT_AND:return!1;case p.GroupType.OR:return!0;case p.GroupType.NOT_OR:continue}else switch(n.groupType){case p.GroupType.AND:return!1;case p.GroupType.NOT_AND:case p.GroupType.OR:continue;case p.GroupType.NOT_OR:return!0}}switch(n.groupType){case p.GroupType.AND:case p.GroupType.NOT_AND:return!0;case p.GroupType.OR:case p.GroupType.NOT_OR:return!1}}for(var o,i=function e(r){return r.type===p.FilterType.CONDITION?n.find((function(e){return e.name===r.fieldName})).values.map((function(e){try{return t[r.dataType][r.method](e,r.argument)}catch(e){return!1}})):r.filters.map(e)}(e),l=function(t,l,u){!1===r(t,i,e)&&(n.forEach((function(e){return e.values.splice(t-u,1)})),++u),o=u},u=0,a=n[0].values.length,d=0;u<a;++u)l(u,0,d),d=o;return n},s={name:"FilterGroup",emits:["addFilter","deleteGroup"],props:{group:{type:Object,required:!0,validator:function(e){return e.constructor===Object}},filterTypes:{type:Array,required:!0},groupTypes:{type:Array,required:!0},removable:{type:Boolean,required:!0}},methods:{addFilter:function(e){this.filterTypes.includes(e)&&this.$emit("addFilter",this.group.filters,e)}}},m={class:"space-y-4"},f={class:"space-x-2"},y=["value"],h=["value"],g={key:0,class:"ml-10 space-y-1"};s.render=function(t,n,r,o,i,l){return e.openBlock(),e.createElementBlock("div",m,[e.createElementVNode("div",f,[e.renderSlot(t.$slots,"groupTypes",e.normalizeProps(e.guardReactiveProps({groupTypes:r.groupTypes,group:r.group})),(function(){return[e.withDirectives(e.createElementVNode("select",{"onUpdate:modelValue":n[0]||(n[0]=function(e){return r.group.groupType=e})},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.groupTypes,(function(t){return e.openBlock(),e.createElementBlock("option",{key:t,value:t},e.toDisplayString(t),9,y)})),128))],512),[[e.vModelSelect,r.group.groupType]])]})),e.renderSlot(t.$slots,"filterAddition",e.normalizeProps(e.guardReactiveProps({filterTypes:r.filterTypes,addFilter:l.addFilter})),(function(){return[e.createElementVNode("select",{onChange:n[1]||(n[1]=function(e){return l.addFilter(e.target.value)})},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.filterTypes,(function(t){return e.openBlock(),e.createElementBlock("option",{key:t,value:t},e.toDisplayString(t),9,h)})),128))],32)]})),r.removable?e.renderSlot(t.$slots,"groupDeletion",{key:0,deleteGroup:function(){return t.$emit("deleteGroup",r.group)}},(function(){return[e.createElementVNode("button",{onClick:n[2]||(n[2]=function(e){return t.$emit("deleteGroup",r.group)})},"x")]})):e.createCommentVNode("",!0)]),r.group.filters.length?(e.openBlock(),e.createElementBlock("div",g,[e.renderSlot(t.$slots,"groupChildren")])):e.createCommentVNode("",!0)])};var T={name:"FilterCondition",emits:["updateField","deleteCondition"],props:{condition:{type:Object,required:!0,validator:function(e){return e.constructor===Object}},fieldNames:{type:Array,required:!0},numericMethodNames:{type:Array,required:!0},nominalMethodNames:{type:Array,required:!0}},computed:{isNumeric:function(){return this.condition.dataType===d.DataType.NUMERIC}},methods:{updateField:function(e){this.fieldNames.includes(e)&&this.$emit("updateField",this.condition,e)}}},v={class:"space-x-2"},N=["value"],O=["value"];T.render=function(t,n,r,o,i,l){return e.openBlock(),e.createElementBlock("div",v,[e.renderSlot(t.$slots,"fieldUpdation",e.normalizeProps(e.guardReactiveProps({fieldNames:r.fieldNames,condition:r.condition,updateField:l.updateField})),(function(){return[e.withDirectives(e.createElementVNode("select",{"onUpdate:modelValue":n[0]||(n[0]=function(e){return r.condition.fieldName=e}),onChange:n[1]||(n[1]=function(e){return l.updateField(e.target.value)})},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.fieldNames,(function(t){return e.openBlock(),e.createElementBlock("option",{key:t,value:t},e.toDisplayString(t),9,N)})),128))],544),[[e.vModelSelect,r.condition.fieldName]])]})),e.renderSlot(t.$slots,"methodUpdation",e.normalizeProps(e.guardReactiveProps({numericMethodNames:l.isNumeric&&r.numericMethodNames,nominalMethodNames:l.isNumeric||r.nominalMethodNames,condition:r.condition})),(function(){return[e.withDirectives(e.createElementVNode("select",{"onUpdate:modelValue":n[2]||(n[2]=function(e){return r.condition.method=e})},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.isNumeric?r.numericMethodNames:r.nominalMethodNames,(function(t){return e.openBlock(),e.createElementBlock("option",{key:t,value:t},e.toDisplayString(t),9,O)})),128))],512),[[e.vModelSelect,r.condition.method]])]})),e.renderSlot(t.$slots,"argumentUpdation",{condition:r.condition},(function(){return[e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":n[3]||(n[3]=function(e){return r.condition.argument=e})},null,512),[[e.vModelText,r.condition.argument]])]})),e.renderSlot(t.$slots,"conditionDeletion",{deleteCondition:function(){return t.$emit("deleteCondition",r.condition)}},(function(){return[e.createElementVNode("button",{onClick:n[4]||(n[4]=function(e){return t.$emit("deleteCondition",r.condition)})},"x")]}))])};var F={name:"VueVisualFilter",emits:["filterUpdate"],props:{filteringOptions:{type:Object,required:!0,validator:function(e){try{return e.data.length&&e.data.every((function(e,t,n){return!("string"!=typeof e.name||"string"!=typeof e.type||e.values.constructor!==Array||t>0&&e.values.length!==n[t-1].values.length)}))&&Object.values(e.methods.numeric).every((function(e){return"function"==typeof e}))&&Object.values(e.methods.nominal).every((function(e){return"function"==typeof e}))}catch(e){return!1}}}},data:function(){return{filter:{type:d.FilterType.GROUP,groupType:d.GroupType.AND,filters:[]}}},computed:{fieldNames:function(){return this.filteringOptions.data.map((function(e){return e.name}))},numericMethodNames:function(){return Object.keys(this.filteringOptions.methods.numeric)},nominalMethodNames:function(){return Object.keys(this.filteringOptions.methods.nominal)}},watch:{filter:{deep:!0,handler:function(){this.$emit("filterUpdate",{filter:d.deepCopy(this.filter),data:c(this.filter,this.filteringOptions.methods,d.deepCopy(this.filteringOptions.data))})}}},methods:{updateConditionField:function(e,n){var r=this.filteringOptions.data.find((function(e){return e.name===n})),o=r.type,i=t(r.values,1)[0],l=void 0===i?"":i;e.dataType!==o&&(e.method=(o===d.DataType.NUMERIC?this.numericMethodNames[0]:this.nominalMethodNames[0])||"",e.argument=l,e.dataType=o)},addFilter:function(e,n){if(n===d.FilterType.GROUP)e.push({type:d.FilterType.GROUP,groupType:d.GroupType.AND,filters:[]});else{var r=this.filteringOptions.data[0],o=r.name,i=r.type,l=t(r.values,1)[0],u=void 0===l?"":l;e.push({type:d.FilterType.CONDITION,fieldName:o,dataType:i,method:(i===d.DataType.NUMERIC?this.numericMethodNames[0]:this.nominalMethodNames[0])||"",argument:u})}},deleteFilter:function(e){e!==this.filter&&function t(n,r,o){n===e?o.splice(r,1):n.type===d.FilterType.GROUP&&n.filters.map(t)}(this.filter)}},render:function(){var t=this;return function n(r){return r.type===d.FilterType.GROUP?e.h(s,{group:r,filterTypes:Object.values(d.FilterType),groupTypes:Object.values(d.GroupType),removable:r!==t.filter,onAddFilter:t.addFilter,onDeleteGroup:t.deleteFilter},{groupTypes:t.$slots.groupTypes,filterAddition:t.$slots.filterAddition,groupDeletion:t.$slots.groupDeletion,groupChildren:function(){return r.filters.map(n)}}):e.h(T,{condition:r,fieldNames:t.fieldNames,numericMethodNames:t.numericMethodNames,nominalMethodNames:t.nominalMethodNames,onUpdateField:t.updateConditionField,onDeleteCondition:t.deleteFilter},{fieldUpdation:t.$slots.fieldUpdation,methodUpdation:t.$slots.methodUpdation,argumentUpdation:t.$slots.argumentUpdation,conditionDeletion:t.$slots.conditionDeletion})}(this.filter)},install:function(e){e.component(F.name,F)}};return F}(Vue);
